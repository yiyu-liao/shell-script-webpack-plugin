"use strict";

const webpack = require('webpack');

const test = require('ava');

const {
  resolve,
  join
} = require('path');

const ShellPlugin = require('../');

const outputPath = resolve(__dirname, '../.tmp');

const {
  remove
} = require('fs-extra');

function build(config) {
  return new Promise((resolve, rejects) => {
    webpack(config, (error, stats) => {
      if (error || stats.hasErrors()) {
        rejects(error || stats.toJson('errors-only').errors);
        return;
      }

      resolve(`${config.output.path}/${config.output.filename}`);
    });
  });
}

function createConfig(pluginScript) {
  return {
    entry: resolve(__dirname, './entry.js'),
    output: {
      path: outputPath,
      filename: 'tem.js'
    },
    plugins: [new ShellPlugin(pluginScript)]
  };
}

test('it should new a json file', ({
  truthy
}) => {
  let config = createConfig(['beforeRun', 'sh ./test.sh']);
  return build(config).then(() => {
    const testJson = require('../.temp/test.json');

    const testModule = require(join(outputPath, 'tmp.js'));

    truthy(testJson.test);
    truthy(testModule);
  });
});
test.after.always('cleanup dist file', () => remove(outputPath));
//# sourceMappingURL=/Users/myself/shell-script-webpack-plugin/node_modules/.cache/ava/c9e8325d55fa56ee0484c426105d4699.js.map